{"version":3,"sources":["../../src/controllers/testController.js"],"names":["request","require","md5","app","kline","req","res","collection","query","obj","whereObj","dbhelper","find","result","undefined","json","time","test","module","exports"],"mappings":";;AAEA;;;;AACA;;;;AACA;;;;;;AAJA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,MAAKD,QAAQ,KAAR,CAAT;;;AAOA,IAAIE,MAAM;;AAENC,SAAO,eAASC,GAAT,EAAaC,GAAb,EAAiB;;AAEpB,QAAIC,aAAaF,IAAIG,KAAJ,CAAUD,UAA3B,CAFoB,CAEkB;AACtC;AACD;AACC;AACA;AACA,QAAIE,MAAM,EAACC,UAAS,0BAAV,EAAV;AACAC,uBAASC,IAAT,CAAcL,UAAd,EAAyBE,GAAzB,EAA6B,UAASI,MAAT,EAAgB;;AAE3C,UAAIA,UAAUA,OAAO,CAAP,MAAcC,SAA5B,EAAuC;AACrCR,YAAIS,IAAJ,CAAS,EAAC,SAAQR,UAAT,EAAoB,cAAaM,OAAO,CAAP,EAAUG,IAA3C,EAAT;AACD,OAFD,MAEK;AACHV,YAAIS,IAAJ,CAAS,EAAC,QAAOR,UAAR,EAAT;AACD;AACF,KAPD;AAUN,GApBQ;AAqBRU,QAAM,gBAAU;;AAET;AACH;;AAEA;;AAEA;AACA;AACA;;AAEE;AACA;AACA;AACA;AACA;;AAEH;;AAEG;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEF;;AAEE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACF;AA7FO,CAAV;;AAgGAC,OAAOC,OAAP,GAAiBhB,GAAjB","file":"testController.js","sourcesContent":["var request = require('request');\nvar md5 =require(\"md5\");\nimport monitor from '../models/monitor';\nimport date from '../lib/date';\nimport dbhelper from '../models/dbhelper';\n\n\n\nvar app = {\n\n    kline: function(req,res){\n\n        var collection = req.query.collection;//表\n        //var period= req.query.period;//期间\n       //var currency = req.query.currency;//交易对货币类型\n        //var ex = req.query.ex;//交易所//\n        //console.log(\"009.....\",ex,currency,period);\n        var obj = {whereObj:\"MAX(UPDATE_TIME) as time\"};\n        dbhelper.find(collection,obj,function(result){\n  \n          if (result && result[0] !== undefined) {\n            res.json({'table':collection,'updateTime':result[0].time});\n          }else{\n            res.json({'null':collection});\n          }\n        })\n       \n\n\t},\n  test :function(){\n\n         //吃饭\n      // function eat(data){\n      \n      // var p = new Promise(function(resolve, reject){\n        \n      //    });\n      //   return p;\n      // } \n\n        // var obj = {'whereObj':'OPEN,CLOSE'};//dbhelper-obj\n        // var nowTime = new Date();//时间\n        // var nowTimeStamp = new Date().getTime();//当前时间戳\n        // var nowTimeYmd = date.ymd(nowTimeStamp);//年月日\n        //TIME  EX  CURRENCY  PRICE  RATE_PERCENT \n\n     // monitor.price(collection,obj,function(cbMas){ // 5min - 50min,15min - 2.5h, 30min - 5h , 60min - 10h, 1d - 10d;   \n\n        // var D_value = 0;//权重\n        // var strength = 0 ; //累计\n        // var countNum = -1; //记数\n        // var Data = [];\n        // var cbMasClose = [];//所有收盘价\n        // var cbMasOpen = [];//所有开盘价\n\n        // for(var i in cbMas){\n        //   countNum++;\n        //   if (countNum <100) {\n        //     cbMasOpen.push(cbMas[i].OPEN);//开盘价\n        //     cbMasClose.push(cbMas[i].CLOSE);//收盘价\n\n        //     //var D_value = cbMas[i].CLOSE - cbMas[i].OPEN;//大于0阳线,小于0阴线\n        //     //D_value = D_value.toFixed(2);//保留小数点后两位\n        //     //D_value  = Number(D_value);//字符串 转 数字\n        //     // strength = strength + D_value;//累计+\n        //   }\n        // }\n\n      //strength = strength.toFixed(2);//保留小数点后两位\n        \n        //5min  15min  30min  60min   1d 任何一根线涨跌幅度超过了5%进行记录\n        // var D_change = ((cbMas[0].CLOSE - cbMas[0].OPEN)/cbMas[0].OPEN)*100;//涨跌幅-百分比\n        // var table = 'monitor_bookkeeping';\n        // var keyObj = 'ID,TIME,EX,CURRENCY,PERIOD,PRICE,RATE_PERCENT';\n        // var CID = ex+currency+period;\n        // var newID= md5(CID);//生成id\n        //     newID = newID.replace(/[^0-9]/ig,\"\");//去除字母\n        // var ID = newID.substring(newID.length-5);//取值后5位\n        // var value =  ID+',\"'+nowTimeYmd+'\",\"'+ex+'\",\"'+currency+'\",\"'+period+'\",\"'+cbMas[0].CLOSE+'\",\"'+D_change+'\"';\n\n        //查询异动消息是否已经记录  \n        // var obj = {whereObj:'COUNT(*) as count',limit:'ID',sortObj:ID}; \n        // dbhelper.findOne(table,obj,function(result){\n        // console.log(\"ex,id,D_change...\",ex,ID,D_change);\n        //   if (result && result[0].count === 0) {\n        //     if (D_change>0.5 || D_change<-0.5) {\n        //       //插入异动流水 - -  ID 唯一身份id START_TIME 第一次监测到发生的ymd时间 VALID_TIME 更新时间  EX 交易所  CURRENCY交易对  PERIOD 区间  PRICE 价格  MAX_RATE_PERCENT涨跌 \n        //     dbhelper.insertOne(table,keyObj,value,function(err,result){\n                \n        //         if (!err) {\n        //           console.log(\"insert...bookkeeping...ok\");\n        //         }else{\n        //           console.log(err);\n        //         }\n        //     })\n        //     }\n        //   }else{\n        //     console.log(\"up>>>>>>\",D_change);\n        //   }\n        // })\n     // })\n  }\n}\t\n\nmodule.exports = app;\n\n\n\n\n\n\n\n\n\n"]}