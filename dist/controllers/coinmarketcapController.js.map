{"version":3,"sources":["../../src/controllers/coinmarketcapController.js"],"names":["request","require","md5","rp","app","listLatest","req","res","requestOptions","method","uri","qs","headers","json","gzip","then","console","log","response","rData","coinmarketcap","addListLatest","msg","catch","err","message","getData","collection","obj","dbhelper","find","resData","module","exports"],"mappings":";;AAAA;;;;AACA;;;;;;AAEA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,MAAKD,QAAQ,KAAR,CAAT;AACA,IAAME,KAAKF,QAAQ,iBAAR,CAAX;;AAEA,IAAIG,MAAM;AACN;AACFC,cAAW,oBAASC,GAAT,EAAaC,GAAb,EAAiB;AAC1B,QAAMC,iBAAiB;AACnBC,cAAQ,KADW;AAEnBC,WAAK,qEAFc;AAGnBC,UAAI;AACF,iBAAS,GADP;AAEF,iBAAS,MAFP;AAGF,mBAAW;AAHT,OAHe;AAQnBC,eAAS;AACP,6BAAqB;AADd,OARU;AAWnBC,YAAM,IAXa;AAYnBC,YAAM;AAZa,KAAvB;;AAeEX,OAAGK,cAAH,EAAmBO,IAAnB,CAAwB,oBAAY;AAClCC,cAAQC,GAAR,CAAY,oBAAZ,EAAkCC,QAAlC;AACA,UAAIC,QAAQD,QAAZ;AACAE,8BAAcC,aAAd,CAA4BF,KAA5B,EAAkC,UAASG,GAAT,EAAa;;AAE3Cf,YAAIM,IAAJ,CAAS,EAACS,KAAIA,GAAL,EAAT;AACH,OAHD;AAID,KAPD,EAOGC,KAPH,CAOS,UAACC,GAAD,EAAS;AAChBR,cAAQC,GAAR,CAAY,iBAAZ,EAA+BO,IAAIC,OAAnC;AACD,KATD;AAWD,GA7BK;AA8BNC,WAAS,iBAASpB,GAAT,EAAaC,GAAb,EAAiB;;AAEtB,QAAIoB,aAAa,+BAAjB,CAFsB,CAE2B;AACjD,QAAIC,MAAI,EAAC,YAAW,GAAZ,EAAR,CAHsB,CAGG;;AAEvBC,uBAASC,IAAT,CAAcH,UAAd,EAAyBC,GAAzB,EAA6B,UAASG,OAAT,EAAiB;;AAE1CxB,UAAIM,IAAJ,CAAS,EAAC,QAAOkB,OAAR,EAAT;AACH,KAHD;AAIL;AAvCK,CAAV;AAyCAC,OAAOC,OAAP,GAAiB7B,GAAjB","file":"coinmarketcapController.js","sourcesContent":["import coinmarketcap from '../models/coinmarketcap';\nimport dbhelper from '../models/dbhelper';\n\nvar request = require('request');\nvar md5 =require(\"md5\");\nconst rp = require('request-promise');\n\nvar app = {\n    //获取coinmarketcap的币种列表数据存储到本地数据库\n  listLatest:function(req,res){\n    const requestOptions = {\n        method: 'GET',\n        uri: 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest',\n        qs: {\n          'start': '1',\n          'limit': '5000',\n          'convert': 'USD'\n        },\n        headers: {\n          'X-CMC_PRO_API_KEY': '5845a7f7-4f45-41bc-8d03-2bed2e1c6d34'\n        },\n        json: true,\n        gzip: true\n      };\n\n      rp(requestOptions).then(response => {\n        console.log('API call response:', response);\n        var rData = response;\n        coinmarketcap.addListLatest(rData,function(msg){\n            \n            res.json({msg:msg});\n        });\n      }).catch((err) => {\n        console.log('API call error:', err.message);\n      });\n    \n    },\n    getData: function(req,res){\n\n        var collection = 'coinmarketcap_listings_latest';//查的表\n        var obj={\"whereObj\":\"*\"};//查询参数\n\n          dbhelper.find(collection,obj,function(resData){\n\n              res.json({'data':resData});\n          })             \n    }\n}\nmodule.exports = app;\n\n\n\n\n\n\n\n"]}