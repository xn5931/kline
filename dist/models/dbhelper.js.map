{"version":3,"sources":["../../src/models/dbhelper.js"],"names":["mysql","require","klineController","connection","createConnection","host","user","password","port","database","module","exports","find","collection","obj","cb","whereObj","sortObj","limit","skip","usql","query","err","result","findOne","updateOneById","id","upObj","console","log","updateOneByKey","key","value","updateOne","_connect","db","results","updateMany","sql","deleteMany","deleteOne","insertOne","Sql","insertMany","arr","count","then","dssdsde","findOneById","_id","ObjectId","deleteOneById"],"mappings":";;AAAA;;;;;;AAGA,IAAIA,QAASC,QAAQ,OAAR,CAAb;;AAEA,IAAIC,kBAAkBD,QAAQ,gCAAR,CAAtB;;AAEA,IAAIE,aAAaH,MAAMI,gBAAN,CAAuB;;AAEtCC,UAAW,WAF2B;;AAItCC,UAAW,MAJ2B;;AAMtCC,cAAW,QAN2B;;AAQtCC,UAAM,MARgC;;AAUtCC,cAAU;;AAV4B,CAAvB,CAAjB;AAaA;;;;;;;AAOAC,OAAOC,OAAP,CAAeC,IAAf,GAAoB,UAASC,UAAT,EAAoBC,GAApB,EAAwBC,EAAxB,EAA2B;;AAE3C;AACAD,QAAIE,QAAJ,GAAaF,IAAIE,QAAJ,IAAc,EAA3B;AACAF,QAAIG,OAAJ,GAAYH,IAAIG,OAAJ,IAAa,EAAzB;AACAH,QAAII,KAAJ,GAAUJ,IAAII,KAAJ,IAAW,CAArB;AACAJ,QAAIK,IAAJ,GAASL,IAAIK,IAAJ,IAAU,CAAnB;;AAEA,QAAIC,OAAO,YAAYN,IAAIE,QAAhB,GAA2B,QAA3B,GAAsCH,UAAtC,GAAmD,GAA9D;;AAEAV,eAAWkB,KAAX,CAAiBD,IAAjB,EAAsB,UAASE,GAAT,EAAcC,MAAd,EAAqB;;AAEvC,YAAID,GAAJ,EAAS;;AAEL,mBAAOP,GAAG,iBAAH,EAAqBO,GAArB,CAAP;AAEH,SAJD,MAIK;;AAGD,mBAAOP,GAAGQ,MAAH,CAAP;AACH;AACJ,KAXD;AAYH,CAtBD;;AAwBA,W,CAAW;AACXb,OAAOC,OAAP,CAAea,OAAf,GAAuB,UAASX,UAAT,EAAoBC,GAApB,EAAwBC,EAAxB,EAA2B;;AAE9C;AACAD,QAAIE,QAAJ,GAAaF,IAAIE,QAAJ,IAAc,EAA3B;AACAF,QAAIG,OAAJ,GAAYH,IAAIG,OAAJ,IAAa,EAAzB;AACAH,QAAII,KAAJ,GAAUJ,IAAII,KAAJ,IAAW,CAArB;AACAJ,QAAIK,IAAJ,GAASL,IAAIK,IAAJ,IAAU,CAAnB;;AAEA,QAAIC,OAAO,YAAYN,IAAIE,QAAhB,GAA2B,QAA3B,GAAsCH,UAAtC,GAAmD,SAAnD,GAA6DC,IAAII,KAAjE,GAAuE,KAAvE,GAA6EJ,IAAIG,OAAjF,GAAyF,GAApG;;AAEAd,eAAWkB,KAAX,CAAiBD,IAAjB,EAAsB,UAASE,GAAT,EAAaC,MAAb,EAAoB;AACrC,YAAID,GAAJ,EAAS;;AAEN,mBAAOP,GAAG,iBAAH,EAAqBO,GAArB,CAAP;AAEH,SAJA,MAII;;AAGD,mBAAOP,GAAGQ,MAAH,CAAP;AACH;AACJ,KAVD;AAWH,CArBD;AAsBA;AACA;AACA;;AAEI;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEG;;AAEP;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;AAMA;AACAb,OAAOC,OAAP,CAAec,aAAf,GAA6B,UAASZ,UAAT,EAAoBa,EAApB,EAAuBC,KAAvB,EAA6BZ,EAA7B,EAAgC;;AAEzD,QAAIK,OAAO,YAAUP,UAAV,GAAqB,MAArB,GAA4Bc,KAA5B,GAAkC,cAAlC,GAAiDD,EAAjD,GAAoD,GAA/D;;AAEAvB,eAAWkB,KAAX,CAAiBD,IAAjB,EAAsB,UAASE,GAAT,EAAcC,MAAd,EAAqB;;AAEvC,YAAID,GAAJ,EAAS;;AAELM,oBAAQC,GAAR,CAAY,uBAAZ,EAAoCP,GAApC;AACA,mBAAOP,GAAGO,GAAH,EAAQC,MAAR,CAAP;AACH,SAJD,MAIK;;AAED,mBAAOR,GAAGO,GAAH,EAAQC,MAAR,CAAP;AACH;AACJ,KAVD;AAWH,CAfD;AAgBA;AACAb,OAAOC,OAAP,CAAemB,cAAf,GAA8B,UAASjB,UAAT,EAAoBkB,GAApB,EAAwBC,KAAxB,EAA8BL,KAA9B,EAAoCZ,EAApC,EAAuC;AACjE;;AAEA,QAAIK,OAAO,YAAUP,UAAV,GAAqB,MAArB,GAA4Bc,KAA5B,GAAkC,SAAlC,GAA4CI,GAA5C,GAAgD,KAAhD,GAAsDC,KAAtD,GAA4D,GAAvE;;AAEA;;AAEA7B,eAAWkB,KAAX,CAAiBD,IAAjB,EAAsB,UAASE,GAAT,EAAcC,MAAd,EAAqB;;AAEvC,YAAID,GAAJ,EAAS;;AAEL;;AAEA,mBAAOP,GAAG,0BAAH,EAA8BO,GAA9B,CAAP;AAEH,SAND,MAMK;;AAED;;AAEA,mBAAOP,GAAGO,GAAH,EAAQC,MAAR,CAAP;AACH;AACJ,KAdD;AAgBH,CAvBD;;AAyBA;AACAb,OAAOC,OAAP,CAAesB,SAAf,GAAyB,UAASpB,UAAT,EAAoBG,QAApB,EAA6BW,KAA7B,EAAmCZ,EAAnC,EAAsC;AAC3DmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0BoB,SAA1B,CAAoCjB,QAApC,EAA8CW,KAA9C,EAAqD,UAAUL,GAAV,EAAec,OAAf,EAAwB;AACzErB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND;AAOA;AACA1B,OAAOC,OAAP,CAAe0B,UAAf,GAA0B,UAASC,GAAT,EAAavB,EAAb,EAAgB;;AAEtC;AACAZ,eAAWkB,KAAX,CAAiBiB,GAAjB,EAAqB,UAAShB,GAAT,EAAaC,MAAb,EAAoB;AACrC,eAAOR,GAAGO,GAAH,EAAOC,MAAP,CAAP;AACH,KAFD;AAGH,CAND;AAOA;;AAEA;AACA;AACAb,OAAOC,OAAP,CAAe4B,UAAf,GAA4B,UAAS1B,UAAT,EAAoBC,GAApB,EAAwBC,EAAxB,EAA2B;;AAEnDD,QAAIE,QAAJ,GAAaF,IAAIE,QAAJ,IAAc,EAA3B;AACAF,QAAIG,OAAJ,GAAYH,IAAIG,OAAJ,IAAa,EAAzB;AACAH,QAAII,KAAJ,GAAUJ,IAAII,KAAJ,IAAW,CAArB;AACAJ,QAAIK,IAAJ,GAASL,IAAIK,IAAJ,IAAU,CAAnB;;AAEA,QAAKmB,MAAM,iBAAezB,UAAf,GAA0B,SAA1B,GAAoCC,IAAIE,QAAxC,GAAiD,GAA5D;;AAEAb,eAAWkB,KAAX,CAAiBiB,GAAjB,EAAqB,UAAUhB,GAAV,EAAeC,MAAf,EAAuB;AACxC,eAAOR,GAAGO,GAAH,EAAOC,MAAP,CAAP;AACH,KAFD;AAGH,CAZD;;AAeA;AACAb,OAAOC,OAAP,CAAe6B,SAAf,GAAyB,UAAS3B,UAAT,EAAoBG,QAApB,EAA6BD,EAA7B,EAAgC;AACrDmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0B2B,SAA1B,CAAoCxB,QAApC,EAA8C,UAAUM,GAAV,EAAec,OAAf,EAAwB;AAClErB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND;AAOA;;AAeA;AACA1B,OAAOC,OAAP,CAAe8B,SAAf,GAAyB,UAAS5B,UAAT,EAAoBG,QAApB,EAA6BgB,KAA7B,EAAmCjB,EAAnC,EAAsC;;AAE9D;AACG,QAAI2B,MAAM,iBAAe7B,UAAf,GAA0B,GAA1B,GAA8BG,QAA9B,GAAuC,WAAvC,GAAmDgB,KAAnD,GAA0D,IAApE;AACH7B,eAAWkB,KAAX,CAAiBqB,GAAjB,EAAqB,UAAUpB,GAAV,EAAcC,MAAd,EAAsB;AACpCR,WAAGO,GAAH,EAAOC,MAAP;AACN,KAFD;AAGA,CAPD;;AAYA;AACA;;;;AAIAb,OAAOC,OAAP,CAAegC,UAAf,GAA0B,UAAS9B,UAAT,EAAoB+B,GAApB,EAAwB7B,EAAxB,EAA2B;AACjDmB,aAAS,UAASC,EAAT,EAAY;AACjBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0B8B,UAA1B,CAAqCC,GAArC,EAAyC,UAAStB,GAAT,EAAac,OAAb,EAAqB;AAC1DrB,eAAGO,GAAH,EAAOc,OAAP;AACH,SAFD;AAGH,KAJD;AAKH,CAND;AAOA;AACA;AACA1B,OAAOC,OAAP,CAAekC,KAAf,GAAqB,UAAShC,UAAT,EAAoBG,QAApB,EAA6BD,EAA7B,EAAgC;AACjDmB,aAAS,UAASC,EAAT,EAAY;AACjBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0BgC,KAA1B,CAAgC7B,QAAhC,EAA0C8B,IAA1C,CAA+C,UAASD,KAAT,EAAe;AAC1D9B,eAAG8B,KAAH;AACH,SAFD;AAGH,KAJD;AAMH,CAPD;;AASA;;AAEAnC,OAAOC,OAAP,CAAeoC,OAAf,GAAuB,UAASlC,UAAT,EAAoBG,QAApB,EAA6BD,EAA7B,EAAgC;AACnDmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0BW,OAA1B,CAAkCV,GAAlC,EAAuC,UAAUQ,GAAV,EAAec,OAAf,EAAwB;AAC3DrB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND;AAOA;AACA1B,OAAOC,OAAP,CAAeqC,WAAf,GAA2B,UAASnC,UAAT,EAAoBa,EAApB,EAAuBX,EAAvB,EAA0B;AACjDmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0BW,OAA1B,CAAkC,EAACyB,KAAKjD,MAAMkD,QAAN,CAAexB,EAAf,CAAN,EAAlC,EAA6D,UAAUJ,GAAV,EAAec,OAAf,EAAwB;AACjFrB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND;;AAQA;AACA1B,OAAOC,OAAP,CAAewC,aAAf,GAA6B,UAAStC,UAAT,EAAoBa,EAApB,EAAuBX,EAAvB,EAA0B;AACnDmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0B2B,SAA1B,CAAoC,EAACS,KAAKjD,MAAMkD,QAAN,CAAexB,EAAf,CAAN,EAApC,EAA+D,UAAUJ,GAAV,EAAec,OAAf,EAAwB;AACnFrB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND;AAOA;AACA1B,OAAOC,OAAP,CAAe6B,SAAf,GAAyB,UAAS3B,UAAT,EAAoBG,QAApB,EAA6BD,EAA7B,EAAgC;AACrDmB,aAAS,UAASC,EAAT,EAAa;AAClBA,WAAGtB,UAAH,CAAcA,UAAd,EAA0B2B,SAA1B,CAAoCxB,QAApC,EAA8C,UAAUM,GAAV,EAAec,OAAf,EAAwB;AAClErB,eAAGO,GAAH,EAAQc,OAAR;AACH,SAFD;AAGH,KAJD;AAKH,CAND","file":"dbhelper.js","sourcesContent":["import db from '../db';\n\n\nvar mysql  = require('mysql'); \n\nvar klineController = require('../controllers/klineController');\n\nvar connection = mysql.createConnection({    \n\n  host     : '127.0.0.1',      \n\n  user     : 'root',             \n\n  password : '123456',      \n\n  port: '3306',                  \n\n  database: 'im_k_data',\n\n});\n/*查找  - -pass\n* collection：集合\n* obj:\n*   whereObj:条件，默认是{}\n*   sortObj:排序，默认是{}\n*   limit:显示提定条数,默认是0\n*   skip:跳过指定条数，默认是0*/\nmodule.exports.find=function(collection,obj,cb){\n\n    //如果有条件，将条件赋值给obj.whereObj,没有传条件默认为{}\n    obj.whereObj=obj.whereObj||{};\n    obj.sortObj=obj.sortObj||{};\n    obj.limit=obj.limit||0;\n    obj.skip=obj.skip||0;\n\n    var usql = 'select ' + obj.whereObj + ' from ' + collection + ';'\n    \n    connection.query(usql,function(err, result){\n        \n        if (err) {\n\n            return cb('err dbhelp find',err);\n\n        }else{\n            \n\n            return cb(result);\n        }\n    })\n}\n\n/* 查找一条记录*///- - pass \nmodule.exports.findOne=function(collection,obj,cb){\n\n    //如果有条件，将条件赋值给obj.whereObj,没有传条件默认为{}\n    obj.whereObj=obj.whereObj||{};\n    obj.sortObj=obj.sortObj||{};\n    obj.limit=obj.limit||0;\n    obj.skip=obj.skip||0;\n\n    var usql = 'select ' + obj.whereObj + ' from ' + collection + ' where '+obj.limit+' = '+obj.sortObj+';'\n \n    connection.query(usql,function(err,result){\n         if (err) {\n\n            return cb('err dbhelp find',err);\n\n        }else{\n            \n\n            return cb(result);\n        }\n    })\n}\n/***************************插入***************************/\n//插入一条记录\n// module.exports.insert=function(collection,obj,cb){\n\n    // var  addKlineSql = 'INSERT INTO k_huobi_usdt_btc_1min(id,open,close,low,high,amount,vol,count) VALUES(' + body.data[0].id + ',' + body.data[0].open + ','+ body.data[0].close + ','+ body.data[0].low + ','+ body.data[0].high + ','+ body.data[0].amount + ','+ body.data[0].vol + ','+ body.data[0].count + ');'\n    // //console.log(\"sql.......\",addKlineSql);\n    // //插入k线数据\n    // connection.query(addKlineSql,function (err, result) {\n\n    //     if(err){\n    //         //err.message\n    //         console.log('[ ERROR] - ');\n    //         return;\n    //     }else{\n\n       //console.log(result);\n   \n//     } \n//     });      \n// }\n/***************************插入***************************/\n\n/*****************************修改*******************************/\n//根据ID修改一条记录\n/*\n    collection\n    id\n    upObj\n    cb 回调函数\n*/\n// - - pass\nmodule.exports.updateOneById=function(collection,id,upObj,cb){\n\n    let usql = 'update '+collection+' set'+upObj+' where id = '+id+';'\n\n    connection.query(usql,function(err, result){\n\n        if (err) {\n\n            console.log(\"updateOneById - - err\",err);\n            return cb(err, result);\n        }else{\n\n            return cb(err, result);\n        }\n    })\n}\n// - - pass\nmodule.exports.updateOneByKey=function(collection,key,value,upObj,cb){\n    //update k_huobi_usdt_btc_1min set open ='222' where id=1560477000;\n\n    let usql = 'update '+collection+' set'+upObj+' where '+key+' = '+value+';'\n\n    //console.log(\"usql - - - updateOneById\",usql);\n\n    connection.query(usql,function(err, result){\n\n        if (err) {\n\n            //console.log(\"usql - - - updateOneById\",err);\n\n            return cb('err dbhelp updateOneById',err);\n\n        }else{\n\n            //console.log(result)\n\n            return cb(err, result);\n        }\n    })\n   \n}\n\n//修改一条记录\nmodule.exports.updateOne=function(collection,whereObj,upObj,cb){\n    _connect(function(db) {\n        db.collection(collection).updateOne(whereObj, upObj, function (err, results) {\n            cb(err, results);\n        })\n    });\n}\n//修改多条记录 - - pass\nmodule.exports.updateMany=function(sql,cb){\n\n    //sql='UPDATE '+collection+' SET '\n    connection.query(sql,function(err,result){\n        return cb(err,result);\n    });  \n}\n/*****************************修改*******************************/\n\n/*****************************删除*******************************/\n//修改多条记录 - - pass\nmodule.exports.deleteMany = function(collection,obj,cb){\n\n    obj.whereObj=obj.whereObj||{};\n    obj.sortObj=obj.sortObj||{};\n    obj.limit=obj.limit||0;\n    obj.skip=obj.skip||0;\n\n    var  sql = 'DELETE FROM '+collection+' WHERE '+obj.whereObj+';';\n\n    connection.query(sql,function (err, result) {\n        return cb(err,result);\n    });   \n}\n\n\n//删除一条记录\nmodule.exports.deleteOne=function(collection,whereObj,cb){\n    _connect(function(db) {\n        db.collection(collection).deleteOne(whereObj, function (err, results) {\n            cb(err, results);\n        })\n    });\n}\n/*****************************删除*******************************/\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//插入一条记录 - - pass\nmodule.exports.insertOne=function(collection,whereObj,value,cb){\n\n\t//var  addKlineSql = 'INSERT INTO k_huobi_usdt_btc_1min(id,open,close,low,high,amount,vol,count) VALUES(' + body.data[0].id + ',' + body.data[0].open + ','+ body.data[0].close + ','+ body.data[0].low + ','+ body.data[0].high + ','+ body.data[0].amount + ','+ body.data[0].vol + ','+ body.data[0].count + ');'\n    var Sql = 'INSERT INTO '+collection+'('+whereObj+') VALUES('+value+ ');'\n\tconnection.query(Sql,function (err,result) {\n        cb(err,result);\n\t});      \n}\n\n\n\n\n//插入多条记录\n/*\n* collection:插入的集合，\n* arr:插入的文档\n* cb:回调函数。通过该函数返回执行的结果*/\nmodule.exports.insertMany=function(collection,arr,cb){\n    _connect(function(db){\n        db.collection(collection).insertMany(arr,function(err,results){\n            cb(err,results);\n        })\n    })\n}\n/*********************查找**********************************/\n//根据条件查找记录数\nmodule.exports.count=function(collection,whereObj,cb){\n    _connect(function(db){\n        db.collection(collection).count(whereObj).then(function(count){\n            cb(count);\n        })\n    })\n\n}\n\n/*\n* 查找一条记录*/\nmodule.exports.dssdsde=function(collection,whereObj,cb){\n    _connect(function(db) {\n        db.collection(collection).findOne(obj, function (err, results) {\n            cb(err, results);\n        });\n    });\n}\n//根据ID来查找记录\nmodule.exports.findOneById=function(collection,id,cb){\n    _connect(function(db) {\n        db.collection(collection).findOne({_id: mysql.ObjectId(id)}, function (err, results) {\n            cb(err, results);\n        });\n    });\n}\n\n//根据ID来删除一条记录\nmodule.exports.deleteOneById=function(collection,id,cb){\n    _connect(function(db) {\n        db.collection(collection).deleteOne({_id: mysql.ObjectId(id)}, function (err, results) {\n            cb(err, results);\n        })\n    });\n}\n//删除一条记录\nmodule.exports.deleteOne=function(collection,whereObj,cb){\n    _connect(function(db) {\n        db.collection(collection).deleteOne(whereObj, function (err, results) {\n            cb(err, results);\n        })\n    });\n}\n\n"]}